<!doctype html>
<html lang="de">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link href="styles.css" rel="stylesheet">
  <title>OFF! PDF Viewer</title>
</head>

<body class="bg-light">
  <div class="container py-4">
    <div class="row">
      <div class="col-12">
        <div class="card shadow-sm">
          <div class="card-body">
            <h1 class="h4 mb-3">OFF! PDF Viewer</h1>
            <p class="text-muted mb-4" id="pdfDescription"></p>
            <div id="pdfFrameWrapper" class="ratio ratio-3x4 border rounded">
              <iframe id="pdfFrame" title="OFF PDF" loading="lazy"></iframe>
            </div>
            <div class="mt-3">
              <a class="btn btn-secondary" href="javascript:history.back()">Zurück</a>
              <a class="btn btn-primary" id="pdfDownloadLink" target="_blank" rel="noopener">Download öffnen</a>
            </div>
          </div>
        </div>
        <div id="pdfError" class="alert alert-warning mt-3 d-none" role="alert">
          Das gewünschte Dokument konnte nicht geladen werden. Bitte versuche es erneut oder gehe zurück.
        </div>
      </div>
    </div>
  </div>

  <script>
    const validDocs = {
      "OFF.pdf": "Aktueller Flyer",
      "OFF_Streckendaten.pdf": "Streckendaten",
      "OFF_Ablauf.pdf": "Wie geht OFF?"
    };

    const params = new URLSearchParams(window.location.search);
    const file = params.get("file");
    const descriptionElement = document.getElementById("pdfDescription");
    const pdfFrame = document.getElementById("pdfFrame");
    const pdfDownloadLink = document.getElementById("pdfDownloadLink");
    const pdfError = document.getElementById("pdfError");
    const pdfWrapper = document.getElementById("pdfFrameWrapper");

    if (file && Object.prototype.hasOwnProperty.call(validDocs, file)) {
      const description = validDocs[file];
      const cacheBuster = Date.now();
      const pdfUrl = `/flyer/${file}?v=${cacheBuster}`;

      descriptionElement.textContent = description;
      pdfFrame.src = pdfUrl;
      pdfDownloadLink.href = pdfUrl;
    } else {
      pdfWrapper.classList.add("d-none");
      pdfError.classList.remove("d-none");
      pdfDownloadLink.classList.add("disabled");
    }
  </script>
</body>

</html>
